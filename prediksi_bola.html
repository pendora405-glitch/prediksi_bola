<!-- ============================================================
PREMIUM UI ‚Äì PART A
Header + Style + Layout Container
=============================================================== -->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Prediksi Sepakbola ‚Äì Premium Engine</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f0f2f5;
        margin: 0;
        padding: 20px;
    }
    h2 {
        background: #0057b8;
        color: white;
        padding: 10px 15px;
        border-radius: 6px;
        margin-top: 30px;
    }
    .card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 18px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .row {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }
    .col {
        flex: 1;
        min-width: 240px;
    }
    input, select, button {
        width: 100%;
        padding: 8px;
        margin-top: 6px;
        margin-bottom: 14px;
        border-radius: 6px;
        border: 1px solid #bbb;
        font-size: 14px;
    }
    button {
        background: #0057b8;
        color: white;
        cursor: pointer;
        border: none;
    }
    button:hover {
        background: #003f88;
    }
</style>
</head>

<body>

<h1 style="text-align:center; color:#003f88;">
    ‚öΩ Prediksi Sepakbola ‚Äì Premium Engine UI
</h1>

<div class="container">

<!-- ====================== PART A END ======================== -->
<!-- ============================================================
PREMIUM UI ‚Äì PART B
Input xG / xGA / Error / PPDA / Pressing / TCI Auto
=============================================================== -->

<h2>üîç Data Pertandingan Utama</h2>

<div class="card">
    <div class="row">

        <!-- xG -->
        <div class="col">
            <label>xG Home</label>
            <input id="adv_xg_home" type="number" step="0.01" value="1.40">

            <label>xGA Home</label>
            <input id="adv_xga_home" type="number" step="0.01" value="1.30">
        </div>

        <div class="col">
            <label>xG Away</label>
            <input id="adv_xg_away" type="number" step="0.01" value="1.40">

            <label>xGA Away</label>
            <input id="adv_xga_away" type="number" step="0.01" value="1.30">
        </div>

        <!-- ERROR -->
        <div class="col">
            <label>Error Defensif Home (%)</label>
            <input id="adv_err_home" type="number" step="0.01" value="0.10">

            <label>Error Defensif Away (%)</label>
            <input id="adv_err_away" type="number" step="0.01" value="0.10">
        </div>
    </div>
</div>


<h2>üî• Pressing & PPDA</h2>

<div class="card">
    <div class="row">
        <div class="col">
            <label>PPDA Home</label>
            <input id="ppda_home" type="number" step="0.1" placeholder="Isi jika ada data resmi">
        </div>

        <div class="col">
            <label>PPDA Away</label>
            <input id="ppda_away" type="number" step="0.1" placeholder="Isi jika ada data resmi">
        </div>

        <div class="col">
            <label>Gaya Pressing Home</label>
            <select id="press_style_home">
                <option value="0">Auto</option>
                <option value="9">Ultra High Press</option>
                <option value="8">High Press</option>
                <option value="7">Mid-Press Aggressive</option>
                <option value="6">Mid Block</option>
                <option value="5">Standard</option>
                <option value="4">Low Block</option>
                <option value="3">Passive Defensive</option>
            </select>

            <label>Gaya Pressing Away</label>
            <select id="press_style_away">
                <option value="0">Auto</option>
                <option value="9">Ultra High Press</option>
                <option value="8">High Press</option>
                <option value="7">Mid-Press Aggressive</option>
                <option value="6">Mid Block</option>
                <option value="5">Standard</option>
                <option value="4">Low Block</option>
                <option value="3">Passive Defensive</option>
            </select>
        </div>
    </div>
</div>


<h2>üöÄ TCI ‚Äì Tempo / Chaos / Importance (Auto)</h2>

<div class="card">
    <div class="row">

        <div class="col">
            <label>Jenis Liga</label>
            <select id="league_type">
                <option>EPL</option>
                <option>Bundesliga</option>
                <option>La Liga</option>
                <option>Serie A</option>
                <option>Ligue 1</option>
            </select>

            <label>Jenis Pertandingan</label>
            <select id="match_type">
                <option>League Match</option>
                <option>Derby</option>
                <option>Cup</option>
                <option>Knockout</option>
                <option>Final</option>
            </select>
        </div>

        <div class="col">
            <label>TCI Tempo (Auto)</label>
            <input id="tci_tempo" type="number" step="0.01" readonly>

            <label>TCI Chaos (Auto)</label>
            <input id="tci_chaos" type="number" step="0.01" readonly>

            <label>TCI Importance (Auto)</label>
            <input id="tci_importance" type="number" step="0.01" readonly>
        </div>

        <div class="col">
            <button id="btnTCI">Hitung Auto TCI</button>
        </div>

    </div>
</div>

<!-- ====================== PART B END ======================== -->
<!-- ============================================================
PREMIUM UI ‚Äì PART C
Momentum / Stability / Flexibility / Trend Analyzer
=============================================================== -->

<h2>üìà Momentum, Stability, Flexibility</h2>

<div class="card">
    <div class="row">

        <!-- MOMENTUM -->
        <div class="col">
            <label>Momentum Home (1‚Äì10)</label>
            <input id="home_mom" type="number" min="1" max="10" value="5">

            <label>Momentum Away (1‚Äì10)</label>
            <input id="away_mom" type="number" min="1" max="10" value="5">
        </div>

        <!-- STABILITY -->
        <div class="col">
            <label>Stability Home (1‚Äì10)</label>
            <input id="home_st" type="number" min="1" max="10" value="5">

            <label>Stability Away (1‚Äì10)</label>
            <input id="away_st" type="number" min="1" max="10" value="5">
        </div>

        <!-- FLEXIBILITY -->
        <div class="col">
            <label>Flexibility Home (1‚Äì10)</label>
            <input id="home_flex" type="number" min="1" max="10" value="5">

            <label>Flexibility Away (1‚Äì10)</label>
            <input id="away_flex" type="number" min="1" max="10" value="5">
        </div>

    </div>
</div>


<h2>üèüÔ∏è Home Advantage & Form Match</h2>

<div class="card">
    <div class="row">

        <div class="col">
            <label>Home Advantage (HA) ‚Äì 1 sampai 10</label>
            <input id="ha_value" type="number" min="1" max="10" value="5">
        </div>

        <div class="col">
            <label>Form Home (Rata-rata 3‚Äì5 laga)</label>
            <input id="form_home" type="number" step="0.01" value="0">

            <label>Form Away (Rata-rata 3‚Äì5 laga)</label>
            <input id="form_away" type="number" step="0.01" value="0">
        </div>

        <div class="col">
            <button id="btn_trend">Hitung Trend Analyzer</button>
        </div>

    </div>
</div>

<!-- ====================== PART C END ======================== -->
  <!-- ============================================================
PREMIUM UI ‚Äì PART D
Difficulty / Flow / DIM / TCA / PIM / xT Engines
=============================================================== -->

<h2>üß† Difficulty Rating & Flow Engine</h2>

<div class="card">
    <div class="row">

        <!-- Difficulty Engine -->
        <div class="col">
            <label>Difficulty Base (1‚Äì10)</label>
            <input id="diff_base" type="number" min="1" max="10" value="5">

            <button id="btn_diff">Hitung Difficulty Rating</button>
        </div>

        <!-- Flow Engine -->
        <div class="col">
            <label>Flow Input Home (0‚Äì100)</label>
            <input id="flow_home" type="number" min="0" max="100" value="50">

            <label>Flow Input Away (0‚Äì100)</label>
            <input id="flow_away" type="number" min="0" max="100" value="50">

            <button id="btn_flow">Hitung Flow Engine</button>
        </div>

    </div>
</div>


<h2>üõ∞Ô∏è DIM / TCA / PIM ‚Äì Tactical & Defensive Suite</h2>

<div class="card">
    <div class="row">

        <div class="col">
            <button id="btn_dim">Hitung DIM v2</button>
        </div>

        <div class="col">
            <button id="btn_tca">Hitung TCA v2</button>
        </div>

        <div class="col">
            <button id="btn_pim">Hitung PIM v2</button>
        </div>

    </div>
</div>


<h2>üéØ xT-lite & xT-MAX Engines</h2>

<div class="card">
    <div class="row">

        <div class="col">
            <button id="btn_xtlite">Hitung xT-lite v2</button>
        </div>

        <div class="col">
            <button id="btn_xtmax">Hitung xT-MAX v1</button>
        </div>

        <div class="col">
            <label>Set Piece Rating Home</label>
            <input id="setpiece_home" type="number" min="1" max="10" value="5">

            <label>Set Piece Rating Away</label>
            <input id="setpiece_away" type="number" min="1" max="10" value="5">

            <button id="btn_setp">Hitung Set Piece Strength</button>
        </div>

    </div>
</div>

<!-- ====================== PART D END ======================== -->
  <!-- ============================================================
PREMIUM UI ‚Äì PART E
Prime Engine / Hybrid / Swing / Chaos / Infinity + Output Panel
=============================================================== -->

<h2>üöÄ Prime / Hybrid / Infinity Engine Controls</h2>

<div class="card">

    <div class="row">

        <!-- PRIME ENGINE -->
        <div class="col">
            <button id="btn_analyze">üî∑ Jalankan PRIME Engine</button>
        </div>

        <!-- HYBRID ENGINE -->
        <div class="col">
            <button id="btn_hybrid">üü© Jalankan HYBRID Engine</button>
        </div>

        <!-- SWING REALITY -->
        <div class="col">
            <button id="btn_swing">üü™ Swing Reality</button>
        </div>

        <!-- CHAOS REALITY -->
        <div class="col">
            <button id="btn_chaos">üî¥ Chaos Reality</button>
        </div>

        <!-- INFINITY ENGINE / GUN -->
        <div class="col">
            <button id="btn_grand_unified">üåå Jalankan INFINITY Engine</button>
        </div>

        <!-- BRM ENGINE -->
        <div class="col">
            <button id="btn_brm">üí∞ BRM ‚Äì Smart Staking</button>
        </div>
      <div class="col">
    <button id="btn_matchstyle">üé® Match Style Predictor</button>
      </div>
        <div class="col">
    <button id="btn_scoregrid">üìä Score Grid</button>
        </div>
        <div class="col">
    <button id="btn_matchdiff">üß© Match Difficulty</button>
            <div class="col">
    <button id="btn_swing_momentum">üîÑ Momentum Swing</button>
            </div>
            <div class="col">
        <button id="btn_dxg">üìä Hitung Dynamic xG</button>
            </div>  
            <div class="col">
            <button id="btn_ou_heat">üî• OU Heat Model</button>
            </div>
        </div>
    </div>
</div>



</div> <!-- penutup .container utama -->

  
<!-- ============================================================
PART 1 ‚Äî CORE ENGINE + UTILITAS + AUTO TCI v8
FINAL VERSION
============================================================== -->

<script>

/* ============================================================
   UTILITY FUNCTION
============================================================== */

const PSZ = {};

PSZ.el = (id) => document.getElementById(id);
PSZ.num = (id, def = 0) => {
    let v = parseFloat(PSZ.el(id)?.value);
    return isNaN(v) ? def : v;
};
PSZ.log = (msg) => console.log(msg);

PSZ.state = {};   // tempat penyimpanan data engine global
PSZ.factorial = function(n){
    if (n <= 1) return 1;
    let r = 1;
    for (let i=2; i<=n; i++) r *= i;
    return r;
};


/* ============================================================
   PRESSING & PPDA DEFAULT ‚Üí digunakan di semua engine
============================================================== */
PSZ.getPressing = function(){

    const autoPPDA = PSZ.num("auto_ppda", 0);
    const manHome  = PSZ.num("ppda_home", 0);
    const manAway  = PSZ.num("ppda_away", 0);

    let pressH = 5;
    let pressA = 5;

    // PPDA ‚Äî semakin kecil semakin agresif
    function convertPPDA(ppda){
        if (ppda <= 5) return 9;
        if (ppda <= 8) return 8;
        if (ppda <= 11) return 7;
        if (ppda <= 14) return 6;
        if (ppda <= 17) return 5;
        if (ppda <= 20) return 4;
        if (ppda <= 25) return 3;
        return 2;
    }

    if (manHome > 0) pressH = convertPPDA(manHome);
    if (manAway > 0) pressA = convertPPDA(manAway);

    // jika menggunakan auto pressing berdasarkan gaya
    const gph = PSZ.num("press_style_home", 0);
    const gpa = PSZ.num("press_style_away", 0);

    if (gph > 0) pressH = gph;
    if (gpa > 0) pressA = gpa;

    PSZ.state.pressH = pressH;
    PSZ.state.pressA = pressA;

    return {pressH, pressA};
};


/* ============================================================
   CORE ‚Äî LAMBDA BASE (digunakan oleh Prime / Hybrid / Infinity)
============================================================== */
PSZ.calcLambda = function(){

    PSZ.log("=== LAMBDA ENGINE vNext START ===");

    const xgH  = PSZ.num("adv_xg_home", 1.40);
    const xgA  = PSZ.num("adv_xg_away", 1.40);

    const xgaH = PSZ.num("adv_xga_home", 1.30);
    const xgaA = PSZ.num("adv_xga_away", 1.30);

    const errH = PSZ.num("adv_err_home", 0.10); 
    const errA = PSZ.num("adv_err_away", 0.10);

    const {pressH, pressA} = PSZ.getPressing();

    const tci = PSZ.state.tci_profile || {
        tempo:{global:5},
        chaos:{global:5},
        importance:5
    };

    const tempo = tci.tempo.global;
    const chaos = tci.chaos.global;

    let ŒªH = xgH * 1.00;
    let ŒªA = xgA * 1.00;

    // Error ‚Üí menaikkan xGA
    ŒªH += errA * 0.60;
    ŒªA += errH * 0.60;

    // Pressing ‚Üí mempengaruhi kualitas serangan
    ŒªH *= 1 + (pressH - 5) * 0.04;
    ŒªA *= 1 + (pressA - 5) * 0.04;

    // Tempo / Chaos global ‚Üí penguat kecil
    ŒªH *= 1 + (tempo - 5) * 0.03 + (chaos - 5) * 0.025;
    ŒªA *= 1 + (tempo - 5) * 0.03 + (chaos - 5) * 0.025;

    // Clamp
    function clamp(x){ return Math.max(0.15, Math.min(4.5, x)); }
    ŒªH = clamp(ŒªH);
    ŒªA = clamp(ŒªA);

    PSZ.state.lambda_home = ŒªH;
    PSZ.state.lambda_away = ŒªA;

    PSZ.log("ŒªH = " + ŒªH.toFixed(3) + " | ŒªA = " + ŒªA.toFixed(3));
    PSZ.log("=== LAMBDA ENGINE vNext END ===\n");

    return {lambda_home:ŒªH, lambda_away:ŒªA};
};


/* ============================================================
   AUTO TCI v8 ‚Äî FULL CONTEXTUAL INTELLIGENCE ENGINE
============================================================== */
PSZ.autoTCI = function(){

    PSZ.log("=== AUTO TCI v8 START ===");

    const league = (PSZ.el("league_type")?.value || "").toLowerCase();
    const mtype  = (PSZ.el("match_type")?.value || "").toLowerCase();

    const {pressH, pressA} = PSZ.getPressing();

    const errH = PSZ.num("adv_err_home",0.10);
    const errA = PSZ.num("adv_err_away",0.10);

    const momH = PSZ.num("home_mom",5);
    const momA = PSZ.num("away_mom",5);

    const stH  = PSZ.num("home_st",5);
    const stA  = PSZ.num("away_st",5);

    const flexH = PSZ.num("home_flex",5);
    const flexA = PSZ.num("away_flex",5);

    /* --------------------------------------------------------
       Step 1: Tempo Liga
    -------------------------------------------------------- */
    let tempo = 5;
    switch(league){
        case "epl": tempo = 7; break;
        case "bundesliga": tempo = 7.5; break;
        case "la liga": tempo = 5; break;
        case "serie a": tempo = 4.5; break;
        case "ligue 1": tempo = 5.5; break;
    }

    /* --------------------------------------------------------
       Step 2: Chaos Liga
    -------------------------------------------------------- */
    let chaos = 5;
    switch(league){
        case "epl": chaos = 6.5; break;
        case "bundesliga": chaos = 7; break;
        case "la liga": chaos = 4.5; break;
        case "serie a": chaos = 4; break;
        case "ligue 1": chaos = 5; break;
    }

    /* --------------------------------------------------------
       Step 3: Pengaruh Pressing
    -------------------------------------------------------- */
    const avgPress = (pressH + pressA) / 2;
    tempo += (avgPress - 5) * 0.40;
    chaos += (avgPress - 5) * 0.45;

    /* --------------------------------------------------------
       Step 4: Jenis Pertandingan
    -------------------------------------------------------- */
    let importance = 5;

    if (mtype.includes("derby")){
        tempo += 0.4;
        chaos += 0.7;
        importance += 1;
    }
    if (mtype.includes("cup")){
        importance += 1;
        tempo -= 0.3;
    }
    if (mtype.includes("knockout")){
        importance += 1.5;
        tempo -= 0.4;
        chaos -= 0.3;
    }
    if (mtype.includes("final")){
        importance += 2;
        tempo -= 0.5;
        chaos -= 0.6;
    }

    /* --------------------------------------------------------
       Step 5: Error Defensif
    -------------------------------------------------------- */
    const avgErr = (errH + errA) * 50;
    chaos += (avgErr - 5) * 0.12;
    tempo += (avgErr - 5) * 0.08;

    /* --------------------------------------------------------
       Step 6: Momentum & Stability
    -------------------------------------------------------- */
    const momAvg = (momH + momA) / 2;
    const stAvg  = (stH + stA) / 2;

    tempo += (momAvg - 5) * 0.25;
    chaos += (momAvg - 5) * 0.20;

    chaos -= (stAvg - 5) * 0.12;
    tempo -= (stAvg - 5) * 0.08;

    /* --------------------------------------------------------
       Step 7: Tactical Flexibility
    -------------------------------------------------------- */
    const flexAvg = (flexH + flexA) / 2;
    tempo      += (flexAvg - 5) * 0.12;
    importance += (flexAvg - 5) * 0.10;

    /* --------------------------------------------------------
       Clamp & Simpan
    -------------------------------------------------------- */
    function clamp(x){ return Math.max(1, Math.min(10, x)); }

    tempo      = clamp(tempo);
    chaos      = clamp(chaos);
    importance = clamp(importance);

    PSZ.state.tci_profile = {
        tempo:{global: tempo},
        chaos:{global: chaos},
        importance
    };

    PSZ.el("tci_tempo").value = tempo.toFixed(2);
    PSZ.el("tci_chaos").value = chaos.toFixed(2);
    PSZ.el("tci_importance").value = importance.toFixed(2);

    PSZ.log("TCI v8 ‚Üí Tempo:"+ tempo.toFixed(2));
    PSZ.log("TCI v8 ‚Üí Chaos:"+ chaos.toFixed(2));
    PSZ.log("TCI v8 ‚Üí Importance:"+ importance.toFixed(2));
    PSZ.log("=== AUTO TCI v8 END ===\n");

    return PSZ.state.tci_profile;
};

/* ------------------------------------------------------------
   Tombol
------------------------------------------------------------ */
if (PSZ.el("btnTCI"))
    PSZ.el("btnTCI").onclick = () => PSZ.autoTCI();

</script>
<!-- ============================================================
PART 2 ‚Äî LAMBDA ENGINE vNext
(Foundation for Prime v3, Hybrid v3, Infinity v3)
============================================================== -->

<script>

PSZ.calcLambda = function(){

    PSZ.log("=== LAMBDA ENGINE vNext START ===");

    /* ------------------------------------------------------------
       INPUT DASAR: xG, xGA, Error
    ------------------------------------------------------------ */
    const xgH  = PSZ.num("adv_xg_home", 1.40);
    const xgA  = PSZ.num("adv_xg_away", 1.40);

    const xgaH = PSZ.num("adv_xga_home", 1.30);
    const xgaA = PSZ.num("adv_xga_away", 1.30);

    const errH = PSZ.num("adv_err_home", 0.10);
    const errA = PSZ.num("adv_err_away", 0.10);

    /* ------------------------------------------------------------
       PRESSING / PPDA ‚Üí diambil dari Part 1
    ------------------------------------------------------------ */
    const {pressH, pressA} = PSZ.getPressing();

    /* ------------------------------------------------------------
       TCI v8 ‚Üí Tempo & Chaos mempengaruhi baseline lambda
    ------------------------------------------------------------ */
    const tci = PSZ.state.tci_profile || {
        tempo:{global:5},
        chaos:{global:5},
        importance:5
    };

    const tempo = tci.tempo.global;
    const chaos = tci.chaos.global;

    /* ------------------------------------------------------------
       1. MULAI DARI xG DASAR
    ------------------------------------------------------------ */
    let ŒªH = xgH;
    let ŒªA = xgA;

    /* ------------------------------------------------------------
       2. ERROR DEFENSIF LAWAN
       Error lawan menaikkan peluang menyerang kita
    ------------------------------------------------------------ */
    ŒªH += errA * 0.60;
    ŒªA += errH * 0.60;

    /* ------------------------------------------------------------
       3. PRESSING / PPDA
       Semakin tinggi pressing, semakin banyak potensi open-play
    ------------------------------------------------------------ */
    ŒªH *= 1 + (pressH - 5) * 0.04;
    ŒªA *= 1 + (pressA - 5) * 0.04;

    /* ------------------------------------------------------------
       4. TCI ‚Üí TEMPO & CHAOS
    ------------------------------------------------------------ */
    ŒªH *= 1 + (tempo - 5) * 0.03 + (chaos - 5) * 0.025;
    ŒªA *= 1 + (tempo - 5) * 0.03 + (chaos - 5) * 0.025;

    /* ------------------------------------------------------------
       5. HOME ADVANTAGE
    ------------------------------------------------------------ */
    const ha = PSZ.num("home_adv", 0.05); // default 5%
    ŒªH *= (1 + ha);

    /* ------------------------------------------------------------
       6. JENIS PERTANDINGAN
       Final / Cup ‚Üí lebih ketat
       Derby        ‚Üí lebih liar
    ------------------------------------------------------------ */
    const mtype = (PSZ.el("match_type")?.value || "").toLowerCase();

    if (mtype.includes("final") || mtype.includes("knockout")){
        ŒªH *= 0.97;
        ŒªA *= 0.97;
    }

    if (mtype.includes("derby")){
        ŒªH *= 1.04;
        ŒªA *= 1.04;
    }

    /* ------------------------------------------------------------
       7. CLAMP ‚Üí aman untuk Prime / Hybrid / Infinity
    ------------------------------------------------------------ */
    function clamp(x){ return Math.max(0.15, Math.min(4.5, x)); }

    ŒªH = clamp(ŒªH);
    ŒªA = clamp(ŒªA);

    /* ------------------------------------------------------------
       SIMPAN & LOG
    ------------------------------------------------------------ */
    PSZ.state.lambda_home = ŒªH;
    PSZ.state.lambda_away = ŒªA;

    PSZ.log("ŒªH = " + ŒªH.toFixed(3) + " | ŒªA = " + ŒªA.toFixed(3));
    PSZ.log("=== LAMBDA ENGINE vNext END ===\n");

    return {lambda_home: ŒªH, lambda_away: ŒªA};
};

</script>
<!-- ============================================================
PART 3 ‚Äî PRIME ENGINE v4
============================================================== -->
<script>

PSZ.primeEngine = function () {

    PSZ.log("=== PRIME ENGINE v4 START ===");

    /* -----------------------------------------
       Ambil Lambda dasar (dari Part 2 vNext)
    ------------------------------------------ */
    const base = PSZ.calcLambda();
    if (!base) {
        PSZ.log("ERROR: Lambda belum dihitung.");
        return;
    }

    let ŒªH = base.lambda_home;
    let ŒªA = base.lambda_away;

    /* -----------------------------------------
       DAP ‚Äì Dynamic Attack Profile
       Meningkatkan akurasi Œª
    ------------------------------------------ */
    const mom = PSZ.state.trend || {home:5, away:5};
    const stab = PSZ.state.dim  || {home:6, away:6};
    const xt = PSZ.state.xtlite || {home:10, away:10};
    const press = PSZ.getPressing();

    function dapSide(Œª, momVal, stabVal, pressVal, xtVal){
        let val = Œª;
        val *= 1 + (momVal - 5) * 0.04;
        val *= 1 - (stabVal - 6) * 0.04;
        val *= 1 + (pressVal - 5) * 0.03;
        val *= 1 + (xtVal - 10) * 0.015;
        return val;
    }

    ŒªH = dapSide(ŒªH, mom.home, stab.home, press.pressH, xt.home);
    ŒªA = dapSide(ŒªA, mom.away, stab.away, press.pressA, xt.away);

    /* -----------------------------------------
       TCI Weighted Boost
    ------------------------------------------ */
    const tci = PSZ.state.tci_profile || {tempo:{global:5}, chaos:{global:5}, importance:5};

    ŒªH *= 1 + (tci.tempo.global - 5) * 0.03;
    ŒªA *= 1 + (tci.tempo.global - 5) * 0.03;

    ŒªH *= 1 + (tci.chaos.global - 5) * 0.02;
    ŒªA *= 1 + (tci.chaos.global - 5) * 0.02;

    /* -----------------------------------------
       Draw Adjustment v2
    ------------------------------------------ */
    let drawBias = 1.0;
    const matchType = (PSZ.el("match_type")?.value || "").toLowerCase();

    if (matchType.includes("final"))       drawBias = 1.14;
    else if (matchType.includes("cup"))   drawBias = 1.07;
    else if (matchType.includes("derby")) drawBias = 1.10;

    /* -----------------------------------------
       Clamp Œª
    ------------------------------------------ */
    function clamp(x){ return Math.max(0.10, Math.min(5.0, x)); }

    ŒªH = clamp(ŒªH);
    ŒªA = clamp(ŒªA);

    /* -----------------------------------------
       Poisson Calculation
    ------------------------------------------ */
    function pois(k, Œª) {
        return Math.exp(-Œª) * Math.pow(Œª, k) / PSZ.factorial(k);
    }

    let PH = 0, PD = 0, PA = 0;
    let O25 = 0, U25 = 0;

    for (let h=0; h<=8; h++){
        for (let a=0; a<=8; a++){
            let p = pois(h,ŒªH) * pois(a,ŒªA);

            if (h===a) p *= drawBias;

            if (h>a)  PH += p;
            if (h<a)  PA += p;
            if (h===a) PD += p;

            if ((h+a)>=3) O25 += p;
            else U25 += p;
        }
    }

    const S = PH + PD + PA;

    const out = {
        lambda_home: ŒªH,
        lambda_away: ŒªA,
        oneXtwo: {
            home: PH/S,
            draw: PD/S,
            away: PA/S
        },
        ou25: {
            over: O25,
            under: U25
        }
    };

    PSZ.state.prime = out;

    PSZ.log("Prime v4 Result ‚Üí H:"+(out.oneXtwo.home*100).toFixed(2)+
            " D:"+(out.oneXtwo.draw*100).toFixed(2)+
            " A:"+(out.oneXtwo.away*100).toFixed(2)+"%");
    PSZ.log("=== PRIME ENGINE v4 END ===\n");

    return out;
};

if (PSZ.el("btn_analyze"))
    PSZ.el("btn_analyze").onclick = () => PSZ.primeEngine();

</script>
    
<!-- ============================================================
PART 4 ‚Äî HYBRID SUITE v3
(Chaos v3 + Swing v3 + Hybrid Reality v3)
============================================================== -->

<script>

/* ===============================================================
   CHAOS REALITY ENGINE v3
   - Œª dari PART 2 (calcLambda vNext)
   - TCI (tempo, chaos, importance)
   - Pressing battle (pressH vs pressA)
   - Match type (derby, cup, final)
   - DIM lawan (kalau lemah ‚Üí chaos naik)
================================================================ */
PSZ.chaosReality = function () {

    PSZ.log("=== CHAOS REALITY v3 START ===");

    const base = PSZ.calcLambda();
    let ŒªH = base.lambda_home;
    let ŒªA = base.lambda_away;

    const tci = PSZ.state.tci_profile || {
        tempo:{global:5},
        chaos:{global:5},
        importance:5
    };

    const tempo = tci.tempo.global;
    const chaos = tci.chaos.global;
    const imp   = tci.importance;

    const {pressH, pressA} = PSZ.getPressing();
    const matchType = (PSZ.el("match_type")?.value || "league").toLowerCase();

    const dim = PSZ.state.dim || {home:6, away:6};  // defensive quality

    // faktor chaos/tempo
    const chaosFactor = 1 + (chaos - 5) * 0.10;
    const tempoFactor = 1 + (tempo - 5) * 0.07;

    // pressing battle ‚Üí average pressure
    const pressAvg = (pressH + pressA) / 2;
    const pressFactor = 1 + (pressAvg - 5) * 0.05;

    // pertahanan lawan lemah ‚Üí chaos naik
    const dimH = dim.home; // kualitas bertahan Home
    const dimA = dim.away; // Away
    const defFactorH = 1 + (10 - dimA - 5) * 0.03; // kalau DIM Away kecil ‚Üí ŒªH naik
    const defFactorA = 1 + (10 - dimH - 5) * 0.03;

    ŒªH *= chaosFactor * tempoFactor * pressFactor * defFactorH;
    ŒªA *= chaosFactor * tempoFactor * pressFactor * defFactorA;

    // Match context
    if (matchType === "derby") {
        ŒªH *= 1.04;
        ŒªA *= 1.04;
    }
    if (matchType === "final" || matchType === "knockout" || matchType === "cup") {
        // final umumnya sedikit lebih hati-hati
        ŒªH *= 0.97;
        ŒªA *= 0.97;
    }

    // clamp aman
    function clamp(x){ return Math.max(0.15, Math.min(5.0, x)); }
    ŒªH = clamp(ŒªH);
    ŒªA = clamp(ŒªA);

    PSZ.state.chaos = {lambda_home: ŒªH, lambda_away: ŒªA};

    PSZ.log("Chaos v3 ŒªH: " + ŒªH.toFixed(3));
    PSZ.log("Chaos v3 ŒªA: " + ŒªA.toFixed(3));
    PSZ.log("=== CHAOS REALITY v3 END ===\n");

    return PSZ.state.chaos;
};


/* ===============================================================
   SWING REALITY ENGINE v3
   - Momentum
   - Flexibility
   - Trend (jika sudah dihitung)
   - Error defensif lawan
================================================================ */
PSZ.swingReality = function () {

    PSZ.log("=== SWING REALITY v3 START ===");

    const base = PSZ.calcLambda();
    let ŒªH = base.lambda_home;
    let ŒªA = base.lambda_away;

    const momH  = PSZ.num("home_mom",5);
    const momA  = PSZ.num("away_mom",5);
    const flexH = PSZ.num("home_flex",5);
    const flexA = PSZ.num("away_flex",5);
    const errH  = PSZ.num("adv_err_home",0.10);
    const errA  = PSZ.num("adv_err_away",0.10);

    const trend = PSZ.state.trend || {home:5, away:5};

    // momentum & fleksibilitas
    ŒªH *= 1 + (momH - 5) * 0.05 + (flexH - 5) * 0.03;
    ŒªA *= 1 + (momA - 5) * 0.05 + (flexA - 5) * 0.03;

    // error lawan ‚Üí swing attack kita naik
    ŒªH *= 1 + errA * 1.4;
    ŒªA *= 1 + errH * 1.4;

    // trend positif ‚Üí sedikit buff lagi
    ŒªH *= 1 + (trend.home - 5) * 0.03;
    ŒªA *= 1 + (trend.away - 5) * 0.03;

    function clamp(x){ return Math.max(0.15, Math.min(5.0, x)); }
    ŒªH = clamp(ŒªH);
    ŒªA = clamp(ŒªA);

    PSZ.state.swing = {lambda_home: ŒªH, lambda_away: ŒªA};

    PSZ.log("Swing v3 ŒªH: " + ŒªH.toFixed(3));
    PSZ.log("Swing v3 ŒªA: " + ŒªA.toFixed(3));
    PSZ.log("=== SWING REALITY v3 END ===\n");

    return PSZ.state.swing;
};


/* ===============================================================
   HYBRID REALITY ENGINE v3
   - Menggabungkan:
       ‚Ä¢ Base Œª (Lambda Engine)
       ‚Ä¢ Chaos v3 Œª
       ‚Ä¢ Swing v3 Œª
   - Bobot dinamis: tergantung chaos & match type
================================================================ */
PSZ.hybridEngine = function () {

    PSZ.log("=== HYBRID REALITY ENGINE v3 START ===");

    const prime  = PSZ.state.prime;
    if (!prime) {
        PSZ.log("Prime belum dijalankan.");
        return;
    }

    const base   = PSZ.calcLambda();
    const chaos  = PSZ.chaosReality();
    const swing  = PSZ.swingReality();

    const tci = PSZ.state.tci_profile || {
        tempo:{global:5},
        chaos:{global:5},
        importance:5
    };

    const chaosVal = tci.chaos.global;
    const matchType = (PSZ.el("match_type")?.value || "league").toLowerCase();

    // Bobot awal
    let wBase  = 0.45;
    let wChaos = 0.30;
    let wSwing = 0.25;

    // Chaos tinggi ‚Üí lebih banyak chaos & swing
    if (chaosVal >= 7) {
        wBase  = 0.35;
        wChaos = 0.40;
        wSwing = 0.25;
    }

    // Final / knockout / cup ‚Üí lebih percaya base
    if (matchType === "final" || matchType === "knockout" || matchType === "cup") {
        wBase  = 0.50;
        wChaos = 0.25;
        wSwing = 0.25;
    }

    let ŒªH =
        base.lambda_home   * wBase +
        chaos.lambda_home  * wChaos +
        swing.lambda_home  * wSwing;

    let ŒªA =
        base.lambda_away   * wBase +
        chaos.lambda_away  * wChaos +
        swing.lambda_away  * wSwing;

    function clamp(x){ return Math.max(0.15, Math.min(4.8,x)); }
    ŒªH = clamp(ŒªH);
    ŒªA = clamp(ŒªA);

    // Hitung 1X2 & OU 2.5 dengan Œª hybrid
    function pois(k,Œª){
        return Math.exp(-Œª) * Math.pow(Œª,k) / PSZ.factorial(k);
    }

    let hW=0, dW=0, aW=0;
    let o25=0, u25=0;

    for (let h=0; h<=8; h++){
        for (let a=0; a<=8; a++){
            const p = pois(h,ŒªH)*pois(a,ŒªA);
            if (h > a) hW+=p;
            else if (h===a) dW+=p;
            else aW+=p;

            if (h+a>=3) o25+=p;
            else u25+=p;
        }
    }

    PSZ.state.hybrid = {
        lambda_home: ŒªH,
        lambda_away: ŒªA,
        oneXtwo: {home:hW, draw:dW, away:aW},
        ou25: {over:o25, under:u25}
    };

    PSZ.log("Hybrid v3 1X2 ‚Üí H:"+(hW*100).toFixed(2)+"% | D:"+(dW*100).toFixed(2)+"% | A:"+(aW*100).toFixed(2)+"%");
    PSZ.log("Hybrid v3 OU2.5 ‚Üí O:"+(o25*100).toFixed(2)+"% | U:"+(u25*100).toFixed(2)+"%");
    PSZ.log("=== HYBRID REALITY ENGINE v3 END ===\n");

    return PSZ.state.hybrid;
};


/* ===============================================================
   BIND TOMBOL (TIDAK DIUBAH NAMANYA)
================================================================ */
if (PSZ.el("btnChaos"))
    PSZ.el("btnChaos").onclick = () => PSZ.chaosReality();

if (PSZ.el("btnSwing"))
    PSZ.el("btnSwing").onclick = () => PSZ.swingReality();

if (PSZ.el("btnHybrid"))
    PSZ.el("btnHybrid").onclick = () => PSZ.hybridEngine();

</script>
<!-- ============================================================
PART 5 ‚Äî INFINITY ENGINE v3
(Quantum Fusion Model + Monte Carlo v3 + GUN v3)
============================================================== -->

<script>

/* ===============================================================
   1. MONTE CARLO v3 ‚Äî Quantum Adaptive Simulator
   - Iterasi adaptif dari TCI + Chaos + Error rate
   - Lebih cepat dan lebih akurat dari v2
================================================================ */
PSZ.monteCarlo = function(lambdaH, lambdaA) {

    const tci = PSZ.state.tci_profile || {
        tempo:{global:5},
        chaos:{global:5},
        importance:5
    };

    const chaos = tci.chaos.global;
    const tempo = tci.tempo.global;

    // error rate (semakin besar ‚Üí simulasi diperbanyak)
    const errH = PSZ.num("adv_err_home",0.10);
    const errA = PSZ.num("adv_err_away",0.10);
    const errFactor = 1 + ((errH + errA) / 2) * 3;

    let iterations =
        7000 *
        (1 + (chaos - 5) * 0.08) *
        (1 + (tempo - 5) * 0.05) *
        errFactor;

    iterations = Math.round(Math.max(5000, Math.min(20000, iterations)));

    let hW=0, aW=0, dW=0;
    let over=0, under=0;

    function samplePoisson(Œª){
        const L = Math.exp(-Œª);
        let k = 0, p = 1;
        do { k++; p *= Math.random(); }
        while (p > L);
        return k - 1;
    }

    for (let i=0; i<iterations; i++){
        const h = samplePoisson(lambdaH);
        const a = samplePoisson(lambdaA);

        if (h > a) hW++;
        else if (h < a) aW++;
        else dW++;

        if (h + a >= 3) over++;
        else under++;
    }

    return {
        iterations,
        home: hW / iterations,
        draw: dW / iterations,
        away: aW / iterations,
        over: over / iterations,
        under: under / iterations
    };
};


/* ===============================================================
   2. G.U.N v3 ‚Äî Grand Unified Numbers v3
   Gabungan:
   - SideGap Precision (Œª difference)
   - Threat Bias (xT-lite)
   - Defensive Instability (DIM)
   - Tactical Advantage (TCA)
================================================================ */
PSZ.gun = function(hybrid, mc, ŒªH, ŒªA) {

    const xt  = PSZ.state.xtlite || {home:10, away:10};
    const dim = PSZ.state.dim    || {home:6,  away:6};
    const tca = PSZ.state.tca    || {home:5,  away:5};

    const gap = ŒªH - ŒªA;

    // sidegap: presisi 1-10
    let sidegap = 5 + gap * 2.8;
    sidegap = Math.max(1, Math.min(10, sidegap));

    // threat bias: dari xT-lite (selisih ancaman)
    let threatBias = 5 + ((xt.home - xt.away) / 12);
    threatBias = Math.max(1, Math.min(10, threatBias));

    // defensive instability: home vs away
    let defInst = 5 + ( (10 - dim.home) - (10 - dim.away) ) * 0.28;
    defInst = Math.max(1, Math.min(10, defInst));

    // tactical advantage
    let tacAdv = 5 + (tca.home - tca.away) * 0.4;
    tacAdv = Math.max(1, Math.min(10, tacAdv));

    return {sidegap, threatBias, defInst, tacAdv};
};


/* ===============================================================
   3. INFINITY ENGINE v3 ‚Äî Quantum Fusion Model
   Menggabungkan:
   - Prime v3
   - Hybrid v3
   - Monte Carlo v3
   - GUN v3
   - DIM v2
   - TCA v2
   - xT-lite v2
================================================================ */
PSZ.infinityEngine = function () {

    PSZ.log("=== INFINITY ENGINE v3 START ===");

    const prime  = PSZ.state.prime;
    const hybrid = PSZ.state.hybrid;

    if (!prime || !hybrid) {
        PSZ.log("Prime / Hybrid belum dihitung ‚Üí jalankan PRIME & HYBRID dulu.");
        return;
    }

    const ŒªH = hybrid.lambda_home;
    const ŒªA = hybrid.lambda_away;

    // Monte Carlo v3
    const mc = PSZ.monteCarlo(ŒªH, ŒªA);

    // GUN v3
    const gun = PSZ.gun(hybrid, mc, ŒªH, ŒªA);

    /* ----------------------------------------------------
       Quantum Fusion Blending System
       Bobot adaptif yang menyesuaikan:
       - Chaos
       - Importance
       - Stability (DIM)
       - Tactical matchup (TCA)
    ---------------------------------------------------- */
    const tci = PSZ.state.tci_profile || {chaos:{global:5}, importance:5};
    const chaos = tci.chaos.global;
    const imp   = tci.importance;

    const dim = PSZ.state.dim || {home:6, away:6};
    const tca = PSZ.state.tca || {home:5, away:5};

    // base weights
    let wPrime  = 0.30;
    let wHybrid = 0.33;
    let wMC     = 0.37;

    // chaos tinggi ‚Üí MC dan Hybrid lebih penting
    if (chaos >= 7){
        wPrime  = 0.25;
        wHybrid = 0.35;
        wMC     = 0.40;
    }

    // match importance tinggi ‚Üí Prime naik
    if (imp >= 7){
        wPrime  += 0.05;
        wMC     -= 0.05;
    }

    // pertahanan sangat lemah ‚Üí MC naik
    if (dim.home <= 4 || dim.away <= 4){
        wMC   += 0.04;
        wPrime-= 0.04;
    }

    // taktik salah satu unggul jauh ‚Üí Hybrid naik
    if (Math.abs(tca.home - tca.away) >= 2){
        wHybrid += 0.05;
        wPrime  -= 0.02;
        wMC     -= 0.03;
    }

    // Normalisasi bobot
    const totalW = wPrime + wHybrid + wMC;
    wPrime  /= totalW;
    wHybrid /= totalW;
    wMC     /= totalW;

    // Blend 1X2
    const infH =
        prime.oneXtwo.home   * wPrime +
        hybrid.oneXtwo.home * wHybrid +
        mc.home             * wMC;

    const infD =
        prime.oneXtwo.draw   * wPrime +
        hybrid.oneXtwo.draw * wHybrid +
        mc.draw             * wMC;

    const infA =
        prime.oneXtwo.away   * wPrime +
        hybrid.oneXtwo.away * wHybrid +
        mc.away             * wMC;

    // Blend O/U 2.5
    const infOver =
        prime.ou25.over   * wPrime +
        hybrid.ou25.over * wHybrid +
        mc.over           * wMC;

    const infUnder =
        prime.ou25.under   * wPrime +
        hybrid.ou25.under * wHybrid +
        mc.under           * wMC;

    // Simpan
    PSZ.state.infinity = {
        oneXtwo: {home: infH, draw: infD, away: infA},
        ou25:   {over: infOver, under: infUnder},
        mc,
        gun
    };

    // Log output
    PSZ.log("Infinity v3 1X2 ‚Üí H:"+(infH*100).toFixed(2)+"% | D:"+(infD*100).toFixed(2)+"% | A:"+(infA*100).toFixed(2)+"%");
    PSZ.log("Infinity v3 OU2.5 ‚Üí O:"+(infOver*100).toFixed(2)+"% | U:"+(infUnder*100).toFixed(2)+"%");
    PSZ.log("Iterations (MC v3): "+mc.iterations);
    PSZ.log("GUN v3 ‚Üí Sidegap:"+gun.sidegap.toFixed(2)+
            " | Threat:"+gun.threatBias.toFixed(2)+
            " | DefInst:"+gun.defInst.toFixed(2)+
            " | TacAdv:"+gun.tacAdv.toFixed(2));
    PSZ.log("=== INFINITY ENGINE v3 END ===\n");
};


/* ===============================================================
   BIND TOMBOL INFINITY (tidak diubah namanya)
================================================================ */
if (PSZ.el("btnInfinity"))
    PSZ.el("btnInfinity").onclick = () => PSZ.infinityEngine();

if (PSZ.el("btnGUN"))
    PSZ.el("btnGUN").onclick = () => PSZ.infinityEngine();

</script>
<!-- ============================================================
PART 6 ‚Äî ANALYTICS SUITE v3
(Difficulty v3, Flow v2, Trend v2, SetPiece v2, BRM v2)
============================================================== -->

<script>

/* ===============================================================
   DIFFICULTY MODEL v3
   Mengukur tingkat kesulitan pertandingan H/A
================================================================ */
PSZ.calcDifficulty = function(){

    PSZ.log("=== DIFFICULTY v3 START ===");

    const prime   = PSZ.state.prime;
    const hybrid  = PSZ.state.hybrid;
    const inf     = PSZ.state.infinity;

    if (!prime || !hybrid){
        PSZ.log("Difficulty: Prime / Hybrid belum dihitung.");
        return;
    }

    const dim = PSZ.state.dim || {home:6, away:6};
    const tci = PSZ.state.tci_profile || {importance:5};

    const imp = tci.importance;

    function diffSide(dimSelf, ŒªOpp){
        let d = 5;

        d += (ŒªOpp - 1.3) * 2.0;
        d -= (dimSelf - 5) * 0.8;
        d += (imp - 5) * 0.5;

        return Math.max(1, Math.min(10, d));
    }

    const dH = diffSide(dim.home, prime.lambda_away);
    const dA = diffSide(dim.away, prime.lambda_home);

    PSZ.state.difficulty = {home:dH, away:dA};

    PSZ.log("Difficulty v3 ‚Üí Home:"+dH.toFixed(2)+" | Away:"+dA.toFixed(2));
    PSZ.log("=== DIFFICULTY v3 END ===\n");

    return PSZ.state.difficulty;
};


/* ===============================================================
   MATCH FLOW v2
   Menentukan siapa yang mengontrol alur permainan
================================================================ */
PSZ.calcFlow = function(){

    PSZ.log("=== MATCH FLOW v2 START ===");

    const prime = PSZ.state.prime;
    const xt    = PSZ.state.xtlite || {home:10, away:10};

    if (!prime){
        PSZ.log("Flow: Prime belum dihitung.");
        return;
    }

    const press = PSZ.state;
    const {pressH, pressA} = PSZ.getPressing();

    let fh = 50;
    fh += (prime.lambda_home - prime.lambda_away) * 10;
    fh += (xt.home - xt.away) * 1.2;
    fh += (pressH - pressA) * 2.5;

    fh = Math.max(0, Math.min(100, fh));
    const fa = 100 - fh;

    PSZ.state.flow = {home: fh, away: fa};

    PSZ.log("Flow ‚Üí Home:"+fh.toFixed(1)+"% | Away:"+fa.toFixed(1)+"%");
    PSZ.log("=== MATCH FLOW v2 END ===\n");

    return PSZ.state.flow;
};


/* ===============================================================
   TREND ANALYZER v2
   Membaca performa jangka pendek (3 pertandingan)
================================================================ */
PSZ.calcTrend = function(){

    PSZ.log("=== TREND v2 START ===");

    const tH1 = PSZ.num("t_form_h1",0);
    const tH2 = PSZ.num("t_form_h2",0);
    const tH3 = PSZ.num("t_form_h3",0);

    const tA1 = PSZ.num("t_form_a1",0);
    const tA2 = PSZ.num("t_form_a2",0);
    const tA3 = PSZ.num("t_form_a3",0);

    let formH = (tH1 + tH2 + tH3) / 3;
    let formA = (tA1 + tA2 + tA3) / 3;

    function scale(x){
        return Math.max(1, Math.min(10, x));
    }

    formH = scale(formH);
    formA = scale(formA);

    PSZ.state.trend = {home: formH, away: formA};

    PSZ.log("Trend v2 ‚Üí Home:"+formH.toFixed(2)+" | Away:"+formA.toFixed(2));
    PSZ.log("=== TREND v2 END ===\n");

    return PSZ.state.trend;
};


/* ===============================================================
   SET PIECE MODEL v2
   Ancaman bola mati berdasarkan xG & pressing
================================================================ */
PSZ.calcSetPiece = function(){

    PSZ.log("=== SET PIECE v2 START ===");

    const xgH = PSZ.num("adv_xg_home",1.4);
    const xgA = PSZ.num("adv_xg_away",1.4);

    const {pressH, pressA} = PSZ.getPressing();

    function sp(xg, press){
        let v = 5;
        v += xg * 2.5;
        v += (press - 5) * 0.8;
        return Math.max(1, Math.min(10, v));
    }

    const spH = sp(xgH, pressH);
    const spA = sp(xgA, pressA);

    PSZ.state.setpiece = {home: spH, away: spA};

    PSZ.log("SetPiece v2 ‚Üí Home:"+spH.toFixed(2)+" | Away:"+spA.toFixed(2));
    PSZ.log("=== SET PIECE v2 END ===\n");

    return PSZ.state.setpiece;
};


/* ===============================================================
   BRM v2 ‚Äî Bankroll Management Advisor
   - Risiko berdasarkan difficulty, flow, GUN, infinity prediction
================================================================ */
PSZ.calcBRM = function(){

    PSZ.log("=== BRM v2 START ===");

    const diff = PSZ.state.difficulty || {home:5, away:5};
    const flow = PSZ.state.flow       || {home:50, away:50};
    const gun  = PSZ.state.infinity?.gun || {sidegap:5, threatBias:5};

    let risk = 5;

    // difficulty ‚Üí semakin tinggi semakin berisiko
    risk += (diff.home + diff.away - 10) * 0.5;

    // flow ‚Üí dominan salah satu menurunkan risiko
    risk -= Math.abs(flow.home - 50) * 0.02;

    // sidegap ‚Üí jika sangat timpang ‚Üí risiko turun
    risk -= (gun.sidegap - 5) * 0.4;

    risk = Math.max(1, Math.min(10, risk));

    let stake = 0.5; // default 0.5% bankroll

    if (risk <= 3) stake = 2.0;
    if (risk <= 2) stake = 3.0;
    if (risk >= 7) stake = 0.3;
    if (risk >= 9) stake = 0.15;

    PSZ.state.brm = {risk, stake};

    PSZ.log("BRM v2 ‚Üí Risk:"+risk.toFixed(2)+" | Stake:"+stake.toFixed(2)+"%");
    PSZ.log("=== BRM v2 END ===\n");

    return PSZ.state.brm;
};


/* ===============================================================
   BINDING TOMBOL ANALYTICS
================================================================ */
if (PSZ.el("btnDifficulty"))
    PSZ.el("btnDifficulty").onclick = () => PSZ.calcDifficulty();

if (PSZ.el("btnFlow"))
    PSZ.el("btnFlow").onclick = () => PSZ.calcFlow();

if (PSZ.el("btnTrend"))
    PSZ.el("btnTrend").onclick = () => PSZ.calcTrend();

if (PSZ.el("btnSetPiece"))
    PSZ.el("btnSetPiece").onclick = () => PSZ.calcSetPiece();

if (PSZ.el("btnBRM"))
    PSZ.el("btnBRM").onclick = () => PSZ.calcBRM();

</script>
<!-- ============================================================
PART 7 ‚Äî ADVANCED CONTEXT ENGINE FINAL
DIM v2  |  TCA v2  |  PIM v2  |  xT-lite v2  |  xT-MAX v1
============================================================== -->

<script>

/* ===============================================================
   DIM v2 ‚Äî Defensive Instability Model
   Mengukur kerentanan/kekuatan bertahan Home & Away
================================================================ */
PSZ.calcDIM = function () {

    PSZ.log("=== DIM v2 START ===");

    const errH  = PSZ.num("adv_err_home",0.10);
    const errA  = PSZ.num("adv_err_away",0.10);

    const stH   = PSZ.num("home_st",5);
    const stA   = PSZ.num("away_st",5);

    const {pressH, pressA} = PSZ.getPressing();

    function dimSide(err, st, oppPress){
        let base = 6;

        base += (err * 10) * 0.40;   // error melemahkan pertahanan
        base -= (st - 5)   * 0.80;   // stabilitas menguatkan pertahanan
        base += (oppPress - 5) * 0.25;

        // 1 = sangat kuat, 10 = sangat rapuh
        return Math.max(1, Math.min(10, base));
    }

    const dimH = dimSide(errH, stH, pressA);
    const dimA = dimSide(errA, stA, pressH);

    PSZ.state.dim = {home: dimH, away: dimA};

    PSZ.log("DIM v2 Home: "+dimH.toFixed(2));
    PSZ.log("DIM v2 Away: "+dimA.toFixed(2));
    PSZ.log("=== DIM v2 END ===\n");

    return PSZ.state.dim;
};


/* ===============================================================
   TCA v2 ‚Äî Tactical Compatibility Advantage
   Mengukur keunggulan taktik head-to-head
================================================================ */
PSZ.calcTCA = function () {

    PSZ.log("=== TCA v2 START ===");

    const flexH = PSZ.num("home_flex",5);
    const flexA = PSZ.num("away_flex",5);

    const momH  = PSZ.num("home_mom",5);
    const momA  = PSZ.num("away_mom",5);

    const {pressH, pressA} = PSZ.getPressing();

    function tcaSide(flex, mom, press, oppFlex){
        let base = 5;

        base += (flex - oppFlex) * 0.45;  // fleksibilitas relatif
        base += (mom - 5)        * 0.30;  // momentum
        base += (press - 5)      * 0.20;  // pressing agresif

        return Math.max(1, Math.min(10, base));
    }

    const tcaH = tcaSide(flexH, momH, pressH, flexA);
    const tcaA = tcaSide(flexA, momA, pressA, flexH);

    PSZ.state.tca = {home: tcaH, away: tcaA};

    PSZ.log("TCA v2 Home: "+tcaH.toFixed(2));
    PSZ.log("TCA v2 Away: "+tcaA.toFixed(2));
    PSZ.log("=== TCA v2 END ===\n");

    return PSZ.state.tca;
};


/* ===============================================================
   PIM v2 ‚Äî Psychological Impact Model
   Dampak mental / tekanan pada kedua tim
================================================================ */
PSZ.calcPIM = function () {

    PSZ.log("=== PIM v2 START ===");

    const imp = PSZ.state.tci_profile?.importance || 5;

    const momH = PSZ.num("home_mom",5);
    const momA = PSZ.num("away_mom",5);

    const stH  = PSZ.num("home_st",5);
    const stA  = PSZ.num("away_st",5);

    function pimSide(mom, st){
        let val = imp;

        val += (mom - 5) * 0.45;  // momentum dorong kepercayaan diri
        val -= (st  - 5) * 0.30;  // stabilitas menurunkan tekanan

        return Math.max(1, Math.min(10, val));
    }

    const pimH = pimSide(momH, stH);
    const pimA = pimSide(momA, stA);

    PSZ.state.pim = {home: pimH, away: pimA};

    PSZ.log("PIM v2 Home: "+pimH.toFixed(2));
    PSZ.log("PIM v2 Away: "+pimA.toFixed(2));
    PSZ.log("=== PIM v2 END ===\n");

    return PSZ.state.pim;
};


/* ===============================================================
   xT-lite v2 ‚Äî Lightweight Threat Model
   Digunakan oleh Flow v2, Infinity v3, dan GUN v3
================================================================ */
PSZ.calcXTLite = function () {

    PSZ.log("=== xT-lite v2 START ===");

    const xgH  = PSZ.num("adv_xg_home",1.40);
    const xgA  = PSZ.num("adv_xg_away",1.40);

    const errH = PSZ.num("adv_err_home",0.10);
    const errA = PSZ.num("adv_err_away",0.10);

    const {pressH, pressA} = PSZ.getPressing();

    function xtSide(xg, err, press){
        let val = 10;

        val += xg * 6.0;        // kualitas peluang
        val += err * 8.0;       // error sendiri menambah potensi chaos
        val += (press - 5) * 1.2;

        return Math.max(1, Math.min(20, val));
    }

    const xtH = xtSide(xgH, errH, pressH);
    const xtA = xtSide(xgA, errA, pressA);

    PSZ.state.xtlite = {home: xtH, away: xtA};

    PSZ.log("xT-lite v2 Home: "+xtH.toFixed(2));
    PSZ.log("xT-lite v2 Away: "+xtA.toFixed(2));
    PSZ.log("=== xT-lite v2 END ===\n");

    return PSZ.state.xtlite;
};


/* ===============================================================
   xT-MAX v1 ‚Äî Advanced Threat Model
   Komplementer xT-lite, bukan pengganti
================================================================ */
PSZ.calcXTMax = function () {

    PSZ.log("=== xT-MAX v1 START ===");

    // Data dasar
    const xgH  = PSZ.num("adv_xg_home", 1.40);
    const xgA  = PSZ.num("adv_xg_away", 1.40);

    const xgaH = PSZ.num("adv_xga_home", 1.30);
    const xgaA = PSZ.num("adv_xga_away", 1.30);

    const errH = PSZ.num("adv_err_home", 0.10);
    const errA = PSZ.num("adv_err_away", 0.10);

    const {pressH, pressA} = PSZ.getPressing();

    const flow   = PSZ.state.flow     || {home:50, away:50};
    const trend  = PSZ.state.trend    || {home:5,  away:5};
    const dim    = PSZ.state.dim      || {home:6,  away:6};
    const sp     = PSZ.state.setpiece || {home:5,  away:5};

    const tci = PSZ.state.tci_profile || {
        tempo:{global:5},
        chaos:{global:5}
    };

    const tempo = tci.tempo.global;
    const chaos = tci.chaos.global;

    function xtSide(xg, xgaOpp, flowVal, trendVal, pressVal, errOpp, dimOpp, spSide){
        let val = 0;

        // core chance quality
        val += xg * 8.0;

        // defensive weakness lawan
        val += (1.8 - xgaOpp) * 4.0;
        val += (10 - dimOpp)  * 0.9;

        // dinamika tim sendiri
        val += (flowVal/10 - 5) * 1.0;   // flow (50 jadi 0)
        val += (trendVal - 5)   * 0.9;
        val += (pressVal - 5)   * 0.7;

        // error lawan
        val += errOpp * 12;

        // set piece threat
        val += (spSide - 5) * 0.9;

        // tempo & chaos global
        val += (tempo - 5) * 1.1;
        val += (chaos - 5) * 0.8;

        return Math.max(1, val);
    }

    const xtH = xtSide(
        xgH, xgaA,
        flow.home, trend.home,
        pressH,
        errA,
        dim.away,
        sp.home
    );

    const xtA = xtSide(
        xgA, xgaH,
        flow.away, trend.away,
        pressA,
        errH,
        dim.home,
        sp.away
    );

    const attackBias  = xtH - xtA;                            // + = Home lebih berbahaya
    const defenseBias = (10 - dim.home) - (10 - dim.away);    // + = Home lebih rapuh

    PSZ.state.xtmax = {
        home: xtH,
        away: xtA,
        attackBias,
        defenseBias
    };

    PSZ.log("xT-MAX Home        : " + xtH.toFixed(2));
    PSZ.log("xT-MAX Away        : " + xtA.toFixed(2));
    PSZ.log("Attack Bias (H-A)  : " + attackBias.toFixed(2));
    PSZ.log("Defense Bias (H-A) : " + defenseBias.toFixed(2));
    PSZ.log("=== xT-MAX v1 END ===\n");

    return PSZ.state.xtmax;
};


/* ===============================================================
   BIND TOMBOL PART 7
================================================================ */

if (PSZ.el("btnDIM"))
    PSZ.el("btnDIM").onclick = () => PSZ.calcDIM();

if (PSZ.el("btnTCA"))
    PSZ.el("btnTCA").onclick = () => PSZ.calcTCA();

if (PSZ.el("btnPIM"))
    PSZ.el("btnPIM").onclick = () => PSZ.calcPIM();

if (PSZ.el("btnXTLite"))
    PSZ.el("btnXTLite").onclick = () => PSZ.calcXTLite();

if (PSZ.el("btnXTMax"))
    PSZ.el("btnXTMax").onclick = () => PSZ.calcXTMax();

PSZ.log("PART 7 Loaded: DIM v2, TCA v2, PIM v2, xT-lite v2, xT-MAX v1.");

</script>
    <!-- ============================================================
PART 8A ‚Äî MATCH STYLE PREDICTOR v1
=============================================================== -->
<script>

PSZ.matchStyle = function () {

    PSZ.log("=== MATCH STYLE PREDICTOR v1 START ===");

    const tci = PSZ.state.tci_profile || {tempo:{global:5}, chaos:{global:5}, importance:5};
    const flow = PSZ.state.flow || {home:50, away:50};
    const press = PSZ.getPressing() || {pressH:5, pressA:5};
    const mom = PSZ.state.trend || {home:5, away:5};
    const dim = PSZ.state.dim || {home:6, away:6};

    const prime = PSZ.state.prime;
    let Œªgap = 0;

    if (prime) {
        Œªgap = Math.abs(prime.lambda_home - prime.lambda_away);
    }

    let style = "";

    /* ===============================
       RULE ENGINE
    =============================== */

    // 1. High Tempo Battle
    if (tci.tempo.global >= 7 && (press.pressH >= 7 || press.pressA >= 7)) {
        style = "üî• High Tempo Battle ‚Äì laga cepat, intens, kemungkinan banyak peluang.";
    }

    // 2. Transition Chaos Match
    else if (tci.chaos.global >= 7 && Œªgap <= 0.6) {
        style = "‚ö° Transition Chaos Match ‚Äì duel transisi, turnover cepat, potensi gol cepat.";
    }

    // 3. Defensive Slow Build
    else if (tci.tempo.global <= 4 && press.pressH <= 5 && press.pressA <= 5) {
        style = "üõ°Ô∏è Defensive Slow Build ‚Äì tempo lambat, kedua tim hati-hati.";
    }

    // 4. Low Block vs High Press
    else if (press.pressH >= 7 && press.pressA <= 4) {
        style = "üìâ Low Block vs High Press ‚Äì satu tim menekan keras, satu tim bertahan rapat.";
    }
    else if (press.pressA >= 7 && press.pressH <= 4) {
        style = "üìâ Low Block vs High Press ‚Äì away agresif, home bertahan dalam.";
    }

    // 5. Momentum Dominated Match
    else if (mom.home >= 7 || mom.away >= 7) {
        style = "üî• Momentum Dominated ‚Äì tim dengan moment terbaik kontrol ritme.";
    }

    // 6. Balanced Tactical Match
    else {
        style = "‚öñÔ∏è Balanced Tactical Match ‚Äì permainan seimbang & terkendali.";
    }

    PSZ.state.matchStyle = style;
    PSZ.log("Match Style ‚Üí " + style);
    PSZ.log("=== MATCH STYLE PREDICTOR END ===\n");

    return style;
};

        </script>
    <!-- ============================================================
PART 8B ‚Äî SCORE PROBABILITY GRID (0‚Äì4 √ó 0‚Äì4)
Uses Poisson model from Prime Engine (Œª Home & Œª Away)
=============================================================== -->
<script>

PSZ.scoreGrid = function () {

    PSZ.log("=== SCORE GRID v1 START ===");

    const prime = PSZ.state.prime;

    if (!prime) {
        PSZ.log("ERROR: Jalankan PRIME ENGINE dulu.");
        return;
    }

    const ŒªH = prime.lambda_home;
    const ŒªA = prime.lambda_away;

    // Poisson Function
    function pois(k, Œª) {
        return Math.exp(-Œª) * Math.pow(Œª, k) / PSZ.factorial(k);
    }

    let grid = [];
    let txt = "\n=== SCORE PROBABILITY GRID (0‚Äì4 √ó 0‚Äì4) ===\n\n";

    txt += "        0        1        2        3        4\n";
    txt += "----------------------------------------------------\n";

    for (let h = 0; h <= 4; h++) {
        let row = [];
        txt += `H${h} | `;

        for (let a = 0; a <= 4; a++) {
            const P = pois(h, ŒªH) * pois(a, ŒªA);
            row.push(P);
            txt += (P * 100).toFixed(2).padStart(6, " ") + "% ";
        }

        grid.push(row);
        txt += "\n";
    }

    PSZ.state.scoreGrid = grid;

    PSZ.log(txt);
    PSZ.log("=== SCORE GRID v1 END ===\n");

    return grid;
};

</script>
    <!-- ============================================================
PART 8C ‚Äî COMBINED MATCH DIFFICULTY ENGINE v3
=============================================================== -->
<script>

PSZ.matchDifficulty = function () {

    PSZ.log("=== MATCH DIFFICULTY ENGINE v3 START ===");

    const tci = PSZ.state.tci_profile || {importance:5};
    const mom = PSZ.state.trend || {home:5, away:5};
    const stab = PSZ.state.dim || {home:6, away:6};
    const press = PSZ.getPressing() || {pressH:5, pressA:5};
    const flow = PSZ.state.flow || {home:50, away:50};
    const xt = PSZ.state.xtlite || {home:10, away:10};

    const prime = PSZ.state.prime;
    let Œªgap = 0;

    if (prime) {
        Œªgap = Math.abs(prime.lambda_home - prime.lambda_away);
    }

    /* ------------------------------------------------------------
       Difficulty Score Calculation (0‚Äì100)
    ------------------------------------------------------------ */
    let score = 0;

    // 1. Stability impact (lebih tidak stabil ‚Üí lebih sulit)
    score += (12 - stab.home) * 4;

    // 2. Momentum (momentum kecil ‚Üí match lebih sulit)
    score += (10 - mom.home) * 3;

    // 3. Pressing differential
    score += Math.abs(press.pressA - press.pressH) * 2.5;

    // 4. TCI Importance
    score += tci.importance * 2;

    // 5. xT difference (expected threat)
    score += Math.abs(xt.home - xt.away) * 1.4;

    // 6. Flow stability (semakin tidak seimbang ‚Üí makin sulit)
    score += Math.abs(flow.home - flow.away) * 0.25;

    // 7. Œª Prediction Gap (Prime confidence)
    score += Œªgap * 12;

    // 8. Cap score
    if (score < 0) score = 0;
    if (score > 100) score = 100;

    /* ------------------------------------------------------------
       Difficulty tier classification
    ------------------------------------------------------------ */

    let tier = "";

    if (score <= 20)       tier = "üü¢ Easy";
    else if (score <= 40)  tier = "üü° Balanced";
    else if (score <= 60)  tier = "üü† Hard";
    else if (score <= 80)  tier = "üî¥ Very Hard";
    else                   tier = "‚ö´ Critical Match";

    const result = {
        difficulty_score: score,
        difficulty_tier: tier
    };

    PSZ.state.difficulty = result;

    PSZ.log("Difficulty Score ‚Üí " + score.toFixed(1));
    PSZ.log("Difficulty Tier  ‚Üí " + tier);
    PSZ.log("=== MATCH DIFFICULTY ENGINE END ===\n");

    return result;
};

    </script>
    <!-- ============================================================
PART 8D ‚Äî MOMENTUM SWING INDICATOR v1
=============================================================== -->
<script>

PSZ.momentumSwing = function () {

    PSZ.log("=== MOMENTUM SWING INDICATOR v1 START ===");

    const mom = PSZ.state.trend || {home:5, away:5};
    const press = PSZ.getPressing() || {pressH:5, pressA:5};
    const flow = PSZ.state.flow || {home:50, away:50};
    const xt = PSZ.state.xtlite || {home:10, away:10};
    const stab = PSZ.state.dim || {home:6, away:6};
    const prime = PSZ.state.prime;

    let Œªgap = 0;
    if (prime) Œªgap = Math.abs(prime.lambda_home - prime.lambda_away);

    /* ------------------------------------------------------------
       Calculate Swing Score (0‚Äì100)
    ------------------------------------------------------------ */

    let score = 0;

    // 1. Momentum gap ‚Äì semakin besar selisih semakin besar swing
    score += Math.abs(mom.home - mom.away) * 6;

    // 2. Pressing delta
    score += Math.abs(press.pressH - press.pressA) * 4;

    // 3. xT difference (threat dominance)
    score += Math.abs(xt.home - xt.away) * 2.5;

    // 4. Flow stability (ketidakstabilan = swing tinggi)
    score += Math.abs(flow.home - flow.away) * 0.25;

    // 5. Stability (semakin tidak stabil ‚Üí swing tinggi)
    score += (12 - stab.home) * 2;

    // 6. Œª prediction gap (prediksi Prime)
    score += Œªgap * 10;

    // clamp
    if (score > 100) score = 100;

    /* ------------------------------------------------------------
       Swing Type Classification
    ------------------------------------------------------------ */
    let type = "";

    if (score >= 75) {
        type = "üîÑ HIGH Swing Potential ‚Äî laga sangat mudah berubah arah.";
    }
    else if (score >= 55) {
        type = "‚ÜîÔ∏è Medium Swing ‚Äî kemungkinan momentum shift cukup besar.";
    }
    else if (mom.home > mom.away && press.pressH >= press.pressA + 2) {
        type = "‚¨ÜÔ∏è Home Swing Advantage ‚Äî potensi tekanan meningkat dari tuan rumah.";
    }
    else if (mom.away > mom.home && press.pressA >= press.pressH + 2) {
        type = "‚¨áÔ∏è Away Swing Advantage ‚Äî potensi perubahan momentum dari tim tamu.";
    }
    else {
        type = "üß± Low Swing ‚Äî pertandingan cenderung stabil & terkontrol.";
    }

    const result = {
        swing_score: score,
        swing_type: type
    };

    PSZ.state.momentumSwing = result;

    PSZ.log("Swing Score ‚Üí " + score.toFixed(1));
    PSZ.log("Swing Type  ‚Üí " + type);
    PSZ.log("=== MOMENTUM SWING INDICATOR END ===\n");

    return result;
};

</script>
    <!-- ============================================================
PART 9 ‚Äî PRESSING ENGINE PREMIUM v2
PPDA ‚Üí prioritas utama
Pressing Style ‚Üí fallback jika PPDA kosong
=============================================================== -->
<script>

PSZ.getPressing = function () {

    // Ambil input PPDA
    const ppdaH = PSZ.num("adv_ppda_home");
    const ppdaA = PSZ.num("adv_ppda_away");

    // Ambil style pressing
    const styleH = PSZ.val("press_style_home");
    const styleA = PSZ.val("press_style_away");

    // Mapping gaya pressing ‚Üí angka
    const map = {
        "9": 9,   // Ultra High Press
        "8": 8,   // Gegenpress / High Intensity
        "7": 7,   // Semi High Press
        "6": 6,   // Positional High
        "5": 5,   // Balanced / Mid Block
        "4": 4,   // Zonal Mid-Low
        "3": 3,   // Deep Low Block
        "2": 2,   // Ultra Compact
        "1": 1    // Passive
    };

    // Fallback style ‚Üí angka
    const pressH = map[styleH] ?? 5;
    const pressA = map[styleA] ?? 5;

    let finalH = pressH;
    let finalA = pressA;

    // PPDA override jika valid
    if (ppdaH > 0) finalH = PSZ.ppdaConvert(ppdaH);
    if (ppdaA > 0) finalA = PSZ.ppdaConvert(ppdaA);

    // Simpan state
    PSZ.state.pressing = {
        home: finalH,
        away: finalA,
        raw_ppda_home: ppdaH,
        raw_ppda_away: ppdaA,
        style_home: pressH,
        style_away: pressA
    };

    return {
        pressH: finalH,
        pressA: finalA
    };
};


// ============================================================
// PPDA ‚Üí pangkat terbalik (semakin kecil PPDA ‚Üí pressing kuat)
// ============================================================
PSZ.ppdaConvert = function (ppda) {
    if (!ppda || ppda <= 0) return 5;      // fallback aman
    if (ppda > 40) return 1;               // sangat pasif
    const val = 12 / ppda;                 // rumus umum PPDA Lite
    return Math.min(9, Math.max(1, val));  // clamp
};

</script>
    <!-- ============================================================
PART 10 ‚Äî TCI FUSION v9
Menggabungkan Pressing, PPDA, Error, Momentum, Stability
=============================================================== -->
<script>

// ==========================
// PROFIL DASAR TCI
// ==========================
PSZ.autoTCI = function () {
    const { pressH, pressA } = PSZ.getPressing();

    // Ambil error defensif
    const errH = PSZ.num("home_err");
    const errA = PSZ.num("away_err");

    // Ambil stability
    const stabH = PSZ.num("home_stab");
    const stabA = PSZ.num("away_stab");

    // Ambil momentum
    const momH = PSZ.num("home_mom");
    const momA = PSZ.num("away_mom");

    // Ambil match importance (skala 1‚Äì5)
    const imp = PSZ.val("match_importance") || 3;

    // ==========================
    // TEMPO
    // ==========================
    let tempoH = (pressH * 0.8) + (momH * 0.5) - (stabH * 0.3);
    let tempoA = (pressA * 0.8) + (momA * 0.5) - (stabA * 0.3);

    // ==========================
    // CHAOS
    // ==========================
    let chaosH = (errH * 0.7) + (pressH * 0.4) + (momH * 0.3);
    let chaosA = (errA * 0.7) + (pressA * 0.4) + (momA * 0.3);

    // ==========================
    // IMPORTANCE
    // ==========================
    let importance = Number(imp);

    // ==========================
    // CLAMP NILAI
    // ==========================
    const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));

    tempoH = clamp(tempoH,1,10);
    tempoA = clamp(tempoA,1,10);
    chaosH = clamp(chaosH,1,10);
    chaosA = clamp(chaosA,1,10);
    importance = clamp(importance,1,5);

    // ==========================
    // SIMPAN STATE
    // ==========================
    PSZ.state.tci_profile = {
        tempoH, tempoA,
        chaosH, chaosA,
        importance
    };

    // ==========================
    // TAMPILKAN KE UI
    // ==========================
    PSZ.write("tci_tempo", ((tempoH + tempoA) / 2).toFixed(2));
    PSZ.write("tci_chaos", ((chaosH + chaosA) / 2).toFixed(2));
    PSZ.write("tci_importance", importance.toFixed(0));

    return PSZ.state.tci_profile;
};

</script>
    <!-- ============================================================
PART 11 ‚Äî MATCH STORY ENGINE v1 (Momentum Curve Engine)
Menghasilkan profil alur pertandingan: Early‚ÄìMid‚ÄìLate
=============================================================== -->
<script>

PSZ.matchStory = function () {

    // Ambil hasil TCI
    const TCI = PSZ.state.tci_profile || {};
    const tempoH = TCI.tempoH ?? 5;
    const tempoA = TCI.tempoA ?? 5;
    const chaosH = TCI.chaosH ?? 5;
    const chaosA = TCI.chaosA ?? 5;

    // Ambil pressing
    const { pressH, pressA } = PSZ.getPressing();

    // Momentum
    const momH = PSZ.num("home_mom");
    const momA = PSZ.num("away_mom");

    // Stability & error
    const stabH = PSZ.num("home_stab");
    const stabA = PSZ.num("away_stab");
    const errH  = PSZ.num("home_err");
    const errA  = PSZ.num("away_err");

    // ===============================
    // EARLY GAME DOMINANCE
    // ===============================
    const earlyScoreH = tempoH + momH + pressH - stabH;
    const earlyScoreA = tempoA + momA + pressA - stabA;

    let early_dom = "Balanced";
    if (earlyScoreH > earlyScoreA + 1.5) early_dom = "Home";
    else if (earlyScoreA > earlyScoreH + 1.5) early_dom = "Away";

    // ===============================
    // MID GAME DOMINANCE
    // ===============================
    const midScoreH = (tempoH * 0.7) + (pressH * 0.6) + (momH * 0.4) - (errH * 0.3);
    const midScoreA = (tempoA * 0.7) + (pressA * 0.6) + (momA * 0.4) - (errA * 0.3);

    let mid_dom = "Balanced";
    if (midScoreH > midScoreA + 1.2) mid_dom = "Home";
    else if (midScoreA > midScoreH + 1.2) mid_dom = "Away";

    // ===============================
    // LATE GAME DOMINANCE
    // ===============================
    const lateScoreH = (momH * 0.7) + (errA * 0.4) - (stabH * 0.5);
    const lateScoreA = (momA * 0.7) + (errH * 0.4) - (stabA * 0.5);

    let late_dom = "Balanced";
    if (lateScoreH > lateScoreA + 1.0) late_dom = "Home";
    else if (lateScoreA > lateScoreH + 1.0) late_dom = "Away";

    // ===============================
    // AGGRESSION LEVEL & VOLATILITY
    // ===============================
    const aggression = Math.min(10, Math.max(1,
        (pressH + pressA + tempoH + tempoA) / 4
    ));

    const volatility = Math.min(10, Math.max(1,
        (chaosH + chaosA + errH + errA) / 4
    ));

    // Simpan hasil
    PSZ.state.match_story = {
        early_dom,
        mid_dom,
        late_dom,
        aggression,
        volatility
    };

    // Tampilkan di UI jika ada tempatnya
    PSZ.to("match_story_output", `
        <b>Early Game:</b> ${early_dom}<br>
        <b>Mid Game:</b> ${mid_dom}<br>
        <b>Late Game:</b> ${late_dom}<br>
        <b>Aggression:</b> ${aggression.toFixed(1)}<br>
        <b>Volatility:</b> ${volatility.toFixed(1)}
    `);

    return PSZ.state.match_story;
};

</script>
    <!-- ============================================================
PART 12 ‚Äî SCENARIO PROBABILITY ENGINE v1
Probabilitas gol per window waktu berdasarkan TCI + Story Engine
=============================================================== -->
<script>

PSZ.goalWindow = function () {

    const TCI = PSZ.state.tci_profile || {};
    const STORY = PSZ.state.match_story || {};

    const tempo = (TCI.tempoH + TCI.tempoA) / 2;
    const chaos = (TCI.chaosH + TCI.chaosA) / 2;

    const { pressH, pressA } = PSZ.getPressing();

    const momH = PSZ.num("home_mom");
    const momA = PSZ.num("away_mom");

    const errH = PSZ.num("home_err");
    const errA = PSZ.num("away_err");

    const stabH = PSZ.num("home_stab");
    const stabA = PSZ.num("away_stab");

    // Utility clamp
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

    // -----------------------------------------------
    // BASE AGGRESSION INDEX
    // -----------------------------------------------
    const aggression = clamp((pressH + pressA + tempo) / 3, 1, 10);
    const volatility = clamp((chaos + errH + errA) / 3, 1, 10);

    // -----------------------------------------------
    // WINDOW FACTORS (menit)
    // -----------------------------------------------
    const windows = [
        { name: "0‚Äì15",   factor: 1.10, dom: STORY.early_dom },
        { name: "15‚Äì30",  factor: 1.00, dom: STORY.early_dom },
        { name: "30‚Äì45",  factor: 0.95, dom: STORY.mid_dom },
        { name: "45‚Äì60",  factor: 1.05, dom: STORY.mid_dom },
        { name: "60‚Äì75",  factor: 1.15, dom: STORY.late_dom },
        { name: "75‚Äì90",  factor: 1.30, dom: STORY.late_dom }
    ];

    let results = [];

    windows.forEach(w => {

        // Dominasi berdasarkan match story
        let domH = 1, domA = 1;

        if (w.dom === "Home") domH = 1.25;
        if (w.dom === "Away") domA = 1.25;

        // Home score index
        const Hscore =
            (tempo * 0.4) +
            (momH * 0.4) +
            (pressH * 0.3) +
            (volatility * 0.2) -
            (stabH * 0.2);

        // Away score index
        const Ascore =
            (tempo * 0.35) +
            (momA * 0.4) +
            (pressA * 0.3) +
            (volatility * 0.2) -
            (stabA * 0.2);

        // Probabilitas final
        const pHome = clamp(Hscore * w.factor * domH * 1.5, 1, 90);
        const pAway = clamp(Ascore * w.factor * domA * 1.5, 1, 90);

        results.push({
            window: w.name,
            home: Number(pHome.toFixed(1)),
            away: Number(pAway.toFixed(1))
        });
    });

    PSZ.state.goal_windows = results;

    // Tampilkan jika UI tersedia
    let html = "<b>Goal Window Probability</b><br>";
    results.forEach(r => {
        html += `${r.window}: Home ${r.home}% ‚Äî Away ${r.away}%<br>`;
    });

    PSZ.to("goal_window_output", html);

    return results;
};

</script>
   <!-- ============================================================
PART 13 ‚Äî DYNAMIC EXPECTED GOALS ENGINE v1 (d-xG)
Mengoreksi xG statis berdasarkan TCI, Pressing, Story, Goal Windows
=============================================================== -->
<script>

PSZ.dynamicXG = function () {

    PSZ.log("=== DYNAMIC xG ENGINE v1 START ===");

    // xG statis dari input
    let xgH = PSZ.num("adv_xg_home");
    let xgA = PSZ.num("adv_xg_away");

    // fallback kalau user belum isi xG, pakai lambda dari Prime / base
    const baseLambda = PSZ.calcLambda?.();
    if (!xgH && baseLambda?.lambda_home) xgH = baseLambda.lambda_home;
    if (!xgA && baseLambda?.lambda_away) xgA = baseLambda.lambda_away;

    // Ambil TCI
    const TCI   = PSZ.state.tci_profile || {};
    const tempo = (TCI.tempoH ?? 5 + TCI.tempoA ?? 5) / 2;
    const chaos = (TCI.chaosH ?? 5 + TCI.chaosA ?? 5) / 2;

    // Pressing
    const { pressH, pressA } = PSZ.getPressing();

    // Story + windows
    const STORY  = PSZ.state.match_story   || {};
    const GW     = PSZ.state.goal_windows  || [];

    const momH   = PSZ.num("home_mom");
    const momA   = PSZ.num("away_mom");
    const errH   = PSZ.num("home_err");
    const errA   = PSZ.num("away_err");
    const stabH  = PSZ.num("home_stab");
    const stabA  = PSZ.num("away_stab");

    const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));

    // -------------------------------------------------
    // 1) Hitung faktor ofensif untuk Home & Away
    // -------------------------------------------------
    function attackFactor(mom, press, tempoLocal, chaosLocal, errOpp, stabSelf) {
        let f = 1.0;
        f += (mom - 5)   * 0.05;   // momentum
        f += (press - 5) * 0.04;   // pressing
        f += (tempoLocal - 5) * 0.03;
        f += (chaosLocal - 5) * 0.025;
        f += (errOpp) * 0.03;      // error lawan menaikkan peluang
        f -= (stabSelf - 6) * 0.03;
        return clamp(f, 0.6, 1.6);
    }

    const tempoH = TCI.tempoH ?? tempo;
    const tempoA = TCI.tempoA ?? tempo;
    const chaosH = TCI.chaosH ?? chaos;
    const chaosA = TCI.chaosA ?? chaos;

    const atkH = attackFactor(momH, pressH, tempoH, chaosH, errA, stabH);
    const atkA = attackFactor(momA, pressA, tempoA, chaosA, errH, stabA);

    // -------------------------------------------------
    // 2) Window boost: kapan tim lebih berbahaya?
    // -------------------------------------------------
    let boostH = 1.0, boostA = 1.0;

    GW.forEach(w => {
        // Home lebih dominan jika persen Home > Away di window itu
        if (w.home > w.away) {
            boostH += 0.01 * (w.home - w.away); // sampai kisaran ~+0.3
        } else if (w.away > w.home) {
            boostA += 0.01 * (w.away - w.home);
        }
    });

    boostH = clamp(boostH, 0.8, 1.5);
    boostA = clamp(boostA, 0.8, 1.5);

    // -------------------------------------------------
    // 3) Dynamic xG
    // -------------------------------------------------
    const dxgH = xgH * atkH * boostH;
    const dxgA = xgA * atkA * boostA;

    const result = {
        xg_home_static: xgH,
        xg_away_static: xgA,
        xg_home_dynamic: dxgH,
        xg_away_dynamic: dxgA,
        attack_factor_home: atkH,
        attack_factor_away: atkA,
        window_boost_home: boostH,
        window_boost_away: boostA
    };

    PSZ.state.dynamic_xg = result;

    // Tulis ringkasan ke output (jika ada textarea / console)
    PSZ.log(
        "d-xG Home: " + dxgH.toFixed(2) + " (static " + xgH.toFixed(2) + ")" +
        " | d-xG Away: " + dxgA.toFixed(2) + " (static " + xgA.toFixed(2) + ")"
    );

    PSZ.to("dxg_output", `
        <b>Dynamic xG</b><br>
        Home: ${dxgH.toFixed(2)} (static ${xgH.toFixed(2)})<br>
        Away: ${dxgA.toFixed(2)} (static ${xgA.toFixed(2)})<br>
        AF Home: ${atkH.toFixed(2)} | Window Boost: ${boostH.toFixed(2)}<br>
        AF Away: ${atkA.toFixed(2)} | Window Boost: ${boostA.toFixed(2)}
    `);

    PSZ.log("=== DYNAMIC xG ENGINE v1 END ===\n");

    return result;
};

</script>
    <!-- ============================================================
PART 14 ‚Äî PARLAY CONFIDENCE MATRIX v1
Menggabungkan Strength, Momentum, d-xG, Story, Difficulty, BRM
=============================================================== -->
<script>

PSZ.parlayMatrix = function () {

    PSZ.log("=== PARLAY MATRIX v1 START ===");

    // Ambil hasil engine-engine sebelumnya
    const dxg   = PSZ.state.dynamic_xg || {};
    const STORY = PSZ.state.match_story || {};
    const GW    = PSZ.state.goal_windows || [];
    const TCI   = PSZ.state.tci_profile || {};

    const lambda = PSZ.calcLambda?.() || {};

    const { pressH, pressA } = PSZ.getPressing();

    const momH  = PSZ.num("home_mom");
    const momA  = PSZ.num("away_mom");

    const stabH = PSZ.num("home_stab");
    const stabA = PSZ.num("away_stab");

    const chaos = (TCI.chaosH + TCI.chaosA) / 2;
    const tempo = (TCI.tempoH + TCI.tempoA) / 2;

    const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));

    // ============================================================
    // 1) STRENGTH INDEX (kekuatan tim)
    // ============================================================
    const strengthH =
        (dxg.xg_home_dynamic ?? 1) * 0.45 +
        (momH * 0.12) +
        (pressH * 0.10) -
        (stabH * 0.07) +
        (lambda.lambda_home ?? 1) * 0.25;

    const strengthA =
        (dxg.xg_away_dynamic ?? 1) * 0.45 +
        (momA * 0.12) +
        (pressA * 0.10) -
        (stabA * 0.07) +
        (lambda.lambda_away ?? 1) * 0.25;

    const normH = clamp(strengthH / (strengthH + strengthA), 0.05, 0.95);
    const normA = clamp(strengthA / (strengthH + strengthA), 0.05, 0.95);

    // ============================================================
    // 2) GAME ENVIRONMENT INDEX (lingkungan pertandingan)
    // ============================================================
    let env = 0;

    // Chaos tinggi ‚Üí banyak gol kejutan
    env += chaos * 0.4;

    // Tempo tinggi ‚Üí peluang over meningkat
    env += tempo * 0.3;

    // Dominasi timeline
    if (STORY.late_dom === "Home") env += 1.0;
    if (STORY.late_dom === "Away") env += 1.0;

    // Window probability mendukung goal
    GW.forEach(w => {
        env += (w.home + w.away) * 0.005;
    });

    env = clamp(env, 1, 10);

    // ============================================================
    // 3) 1X2 CONFIDENCE
    // ============================================================
    const home_win = clamp(normH * 100 + (momH - momA) * 2, 5, 90);
    const away_win = clamp(normA * 100 + (momA - momH) * 2, 5, 90);
    const draw     = clamp(100 - home_win - away_win, 5, 60);

    // ============================================================
    // 4) OVER/UNDER & BTTS
    // ============================================================
    const dxg_total = (dxg.xg_home_dynamic ?? 1) + (dxg.xg_away_dynamic ?? 1);

    const over25 = clamp(dxg_total * env * 6, 10, 92);
    const btts   = clamp(dxg_total * 18, 10, 90);

    // ============================================================
    // 5) PARLAY CONFIDENCE SCORE
    // ============================================================
    let parlay_conf =
        (env * 6) +
        (dxg_total * 8) +
        (Math.max(home_win, away_win) * 0.4);

    parlay_conf = clamp(parlay_conf, 10, 95);

    const result = {
        strength_home: strengthH,
        strength_away: strengthA,
        home_win,
        draw,
        away_win,
        over25,
        btts,
        environment: env,
        parlay_confidence: parlay_conf
    };

    PSZ.state.parlay_matrix = result;

    // Tulis ke output jika UI tersedia
    PSZ.to("parlay_matrix_output", `
        <b>Parlay Matrix v1</b><br>
        Home Win: ${home_win}%<br>
        Draw: ${draw}%<br>
        Away Win: ${away_win}%<br>
        Over 2.5: ${over25}%<br>
        BTTS: ${btts}%<br>
        Parlay Safety Index: ${parlay_conf}%<br>
        Environment: ${env.toFixed(1)}<br>
    `);

    PSZ.log("=== PARLAY MATRIX v1 END ===\n");

    return result;
};

</script>
    <!-- ============================================================
PART 15 ‚Äî CORRECT SCORE GRID v2
Hybrid Poisson + Dynamic xG + Tempo/Chaos + Timeline
=============================================================== -->
<script>

PSZ.correctScoreGrid = function () {

    PSZ.log("=== CORRECT SCORE GRID v2 START ===");

    // Dynamic xG
    const dxg = PSZ.state.dynamic_xg || {};
    let xgH = dxg.xg_home_dynamic ?? 1.1;
    let xgA = dxg.xg_away_dynamic ?? 1.0;

    // Timeline dominasi
    const STORY = PSZ.state.match_story || {};
    const early = STORY.early_dom;
    const late  = STORY.late_dom;

    // Chaos & tempo
    const TCI = PSZ.state.tci_profile || {};
    const tempo = (TCI.tempoH + TCI.tempoA) / 2;
    const chaos = (TCI.chaosH + TCI.chaosA) / 2;

    // Environment dari Part 14
    const ENV = PSZ.state.parlay_matrix?.environment ?? 5;

    const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));

    // Koreksi xG berdasarkan timeline
    if (early === "Home") xgH *= 1.05;
    if (early === "Away") xgA *= 1.05;
    if (late === "Home") xgH *= 1.10;
    if (late === "Away") xgA *= 1.10;

    // Chaos mempengaruhi gol tak terduga
    xgH *= (1 + (chaos - 5) * 0.03);
    xgA *= (1 + (chaos - 5) * 0.03);

    // Tempo mempengaruhi peluang gol awal
    xgH *= (1 + (tempo - 5) * 0.02);
    xgA *= (1 + (tempo - 5) * 0.02);

    // Environment menaikkan total gol
    const goalBoost = 1 + (ENV - 5) * 0.035;
    xgH *= goalBoost;
    xgA *= goalBoost;

    xgH = clamp(xgH, 0.2, 4.5);
    xgA = clamp(xgA, 0.2, 4.5);

    // Poisson with context
    function p(k, lambda) {
        return Math.exp(-lambda) * Math.pow(lambda, k) / factorial(k);
    }

    function factorial(n) {
        if (n === 0) return 1;
        let f = 1;
        for (let i = 1; i <= n; i++) f *= i;
        return f;
    }

    let results = [];
    let totalWeight = 0;

    // Score range 0‚Äì4
    for (let h = 0; h <= 4; h++) {
        for (let a = 0; a <= 4; a++) {

            let baseProb = p(h, xgH) * p(a, xgA);

            // Chaos ‚Üí lebih banyak hasil ekstrem
            if ((h >= 3 || a >= 3) && chaos > 6) baseProb *= 1.15;

            // Stability ‚Üí mengurangi gol besar
            const stabH = PSZ.num("home_stab");
            const stabA = PSZ.num("away_stab");
            if (h >= 3) baseProb *= (1 - stabA * 0.04);
            if (a >= 3) baseProb *= (1 - stabH * 0.04);

            // Momentum advantage
            const momH = PSZ.num("home_mom");
            const momA = PSZ.num("away_mom");
            if (momH > momA + 2 && h > a) baseProb *= 1.10;
            if (momA > momH + 2 && a > h) baseProb *= 1.10;

            totalWeight += baseProb;

            results.push({
                score: `${h}-${a}`,
                raw: baseProb
            });
        }
    }

    // Normalize ke 100%
    results = results.map(r => ({
        score: r.score,
        prob: Number((r.raw / totalWeight * 100).toFixed(2))
    }));

    // Simpan hasil
    PSZ.state.correct_score_grid = results;

    // Tampilkan jika UI tersedia
    let html = "<b>Correct Score Grid (0‚Äì4)</b><br>";
    results.forEach(r => {
        html += `${r.score}: ${r.prob}%<br>`;
    });

    PSZ.to("correct_score_output", html);

    PSZ.log("=== CORRECT SCORE GRID v2 END ===");

    return results;
};

</script>
    <!-- ============================================================
PART 16 ‚Äî OVER/UNDER HEAT MODEL v1
Lines: 0.5 / 1.5 / 2.5 / 3.5 / 4.5
Basis: Dynamic xG + Environment (Parlay Matrix)
=============================================================== -->
<script>

PSZ.ouHeat = function () {

    PSZ.log("=== OVER/UNDER HEAT MODEL v1 START ===");

    const dxg = PSZ.state.dynamic_xg || {};
    let xgH = dxg.xg_home_dynamic ?? dxg.xg_home_static ?? 1.1;
    let xgA = dxg.xg_away_dynamic ?? dxg.xg_away_static ?? 1.0;

    const env = PSZ.state.parlay_matrix?.environment ?? 5;

    const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));

    // total lambda gol
    let Œª = xgH + xgA;

    // adjust dengan environment (tempo+chaos+windows)
    const adj = 1 + (env - 5) * 0.06;
    Œª *= adj;
    Œª = clamp(Œª, 0.2, 6.0);

    // Poisson untuk total gol
    function factorial(n) {
        if (n === 0) return 1;
        let f = 1;
        for (let i = 1; i <= n; i++) f *= i;
        return f;
    }

    function pois(k, lambda) {
        return Math.exp(-lambda) * Math.pow(lambda, k) / factorial(k);
    }

    function probGoalsGE(kMin) {
        let p = 0;
        for (let k = kMin; k <= 12; k++) {
            p += pois(k, Œª);
        }
        return p;
    }

    // Line ‚Üí minimal gol untuk "Over"
    const lines = [
        { key: "0_5", minGoal: 1 },
        { key: "1_5", minGoal: 2 },
        { key: "2_5", minGoal: 3 },
        { key: "3_5", minGoal: 4 },
        { key: "4_5", minGoal: 5 }
    ];

    let result = {};

    lines.forEach(L => {
        const over = probGoalsGE(L.minGoal);
        const under = 1 - over;
        result["O"+L.key] = Number((over * 100).toFixed(2));
        result["U"+L.key] = Number((under * 100).toFixed(2));
    });

    PSZ.state.ou_heat = {
        lambda_total: Œª,
        ...result
    };

    // Tampilkan jika ada elemen output
    let html = "<b>Over/Under Heat Model</b><br>";
    html += `Œª total gol (adj): ${Œª.toFixed(2)}<br><br>`;
    html += `O0.5: ${result.O0_5}% ‚Äî U0.5: ${result.U0_5}%<br>`;
    html += `O1.5: ${result.O1_5}% ‚Äî U1.5: ${result.U1_5}%<br>`;
    html += `O2.5: ${result.O2_5}% ‚Äî U2.5: ${result.U2_5}%<br>`;
    html += `O3.5: ${result.O3_5}% ‚Äî U3.5: ${result.U3_5}%<br>`;
    html += `O4.5: ${result.O4_5}% ‚Äî U4.5: ${result.U4_5}%<br>`;

    PSZ.to("ou_heat_output", html);

    PSZ.log("=== OVER/UNDER HEAT MODEL v1 END ===\n");

    return PSZ.state.ou_heat;
};

</script>
    <script>
// ============================================================
// 1. LOG SYSTEM ‚Äì Semua engine kirim output ke textarea
// ============================================================

if (!window.PSZ) window.PSZ = {};
PSZ.state = PSZ.state || {};

PSZ.el = id => document.getElementById(id);
PSZ.num = (id, d=0) => Number(PSZ.el(id)?.value || d);
PSZ.val = (id, d="") => PSZ.el(id)?.value || d;

PSZ.write = function (msg) {
    const out = document.getElementById("analysis_output");
    if (out) {
        out.value += msg + "\n";
        out.scrollTop = out.scrollHeight;
    }
};

PSZ.log = function (msg) {
    console.log(msg);
    PSZ.write(msg);
};

// ============================================================
// 2. FIX INPUT ‚Äì Samakan ID lama ‚Üî ID engine
// ============================================================

PSZ.fixInput = function () {

    const mapID = (oldID, newID) => {
        const oldEl = document.getElementById(oldID);
        const newEl = document.getElementById(newID);
        if (oldEl && newEl && newEl.value === "") {
            newEl.value = oldEl.value;
        }
    };

    // Contoh mapping (pakai yang sudah ada di filemu)
    mapID("ppda",          "adv_ppda_home");
    mapID("ppda",          "adv_ppda_away");
    mapID("stability_home","home_stab");
    mapID("stability_away","away_stab");
    mapID("error_home",    "home_err");
    mapID("error_away",    "away_err");
    mapID("momentum_home", "home_mom");
    mapID("momentum_away", "away_mom");

    PSZ.log("[FIX] Input mapping selesai.");
};

// ============================================================
// 3. FIX BUTTON ‚Äì Hubungkan tombol UI ‚Üî engine
// ============================================================

PSZ.fixButtons = function () {

    const bind = (id, fn) => {
        const el = document.getElementById(id);
        if (!el) {
            PSZ.log("[WARNING] Tombol tidak ditemukan: " + id);
            return;
        }
        el.addEventListener("click", () => {
            PSZ.log("[RUN] " + id);
            try { fn(); } catch(e){ console.error(e); PSZ.log("ERROR: "+e); }
        });
    };

    // Engine utama
    bind("btn_analyze",        () => PSZ.primeEngine?.());
    bind("btn_hybrid",         () => PSZ.hybridEngine?.());
    bind("btn_chaos",          () => PSZ.chaosReality?.());
    bind("btn_swing",          () => PSZ.swingReality?.());
    bind("btn_grand_unified",  () => PSZ.infinityEngine?.());

    // AI / advanced
    bind("btnTCI",             () => PSZ.autoTCI?.());
    bind("btn_dxg",            () => PSZ.dynamicXG?.());
    bind("btn_scoregrid",      () => PSZ.correctScoreGrid?.());
    bind("btn_ou_heat",        () => PSZ.ouHeat?.());
    bind("btn_swing_momentum", () => PSZ.swingMomentum?.());
    bind("btn_matchstyle",     () => PSZ.matchStyle?.());
    bind("btn_matchdiff",      () => PSZ.matchDifficulty?.());

    // BRM
    bind("btn_brm",            () => PSZ.calcBRM?.());

    // Utility
    bind("btn_auto_calc",      () => { PSZ.autoEstimatePPDA_Lite?.(); PSZ.autoTCI?.(); });
    bind("btn_auto_tci2",      () => PSZ.autoTCI?.());
    bind("btn_clear_output",   () => {
        const out = document.getElementById("analysis_output");
        if (out) out.value = "";
    });

    PSZ.log("[FIX] Semua tombol berhasil dibind.");
};

// ============================================================
// 4. STARTUP ‚Äì Jalankan saat halaman siap
// ============================================================

document.addEventListener("DOMContentLoaded", () => {
    try {
        PSZ.log("=== SCRIPT START ===");
        PSZ.fixInput();
        PSZ.fixButtons();
        PSZ.log("=== SYSTEM READY ===");
    } catch (e) {
        console.error(e);
        PSZ.log("ERROR STARTUP: " + e);
    }
});
</script>
</body>
</html>

   
